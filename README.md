# LogAnalyzer

## Описание проекта

**LogAnalyzer** — это утилита для анализа лог-файлов серверов (например, NGINX). Программа позволяет быстро и
эффективно собирать статистику по логам, используя потоковую обработку данных, что снижает потребление памяти и
позволяет обрабатывать большие объемы данных без необходимости загружать весь файл в оперативную память.
Анализ включает подсчет запросов, наиболее популярные ресурсы, распределение по кодам ответа, средний размер ответа
и другие метрики.

## Основные возможности

- **Потоковая обработка данных:** Обработка логов без полной загрузки в память, что позволяет работать с большими файлами.
- **Анализ временного диапазона:** Поддержка параметров `from` и `to` для фильтрации по дате и времени.
- **Фильтрация по полям:** Возможность фильтровать логи по значениям, например, `method` или `agent`.
- **Форматы отчетов:** Генерация отчетов в форматах Markdown и AsciiDoc.
- **Поддержка локальных и удаленных логов:** Возможность работать с логами по URL или локальному пути.

## Примеры запуска программы

### Простой запуск с локальным файлом

```bash
java -jar log-analyzer-1.0-SNAPSHOT.jar -f ./logs/nginx_logs.txt -r markdown
```

### Запуск с анализом временного диапазона

```bash
java -jar log-analyzer-1.0-SNAPSHOT.jar -f ./logs/nginx_logs.txt -from "2015-05-18T00:00:00Z" -to "2015-05-20T23:59:59Z" -r asciidoc
```

### Фильтрация по HTTP методу

```bash
java -jar log-analyzer-1.0-SNAPSHOT.jar -f ./logs/nginx_logs.txt -filter-field "method" -filter-value "GET"
```

### Поддержка URL для загрузки логов

```bash
java -jar log-analyzer-1.0-SNAPSHOT.jar -f https://example.com/nginx_logs.txt -r markdown
```

## Основные компоненты и методы

### 1. Класс `LogLauncher` и метод `analyzeLogFile`

Метод `analyzeLogFile` отвечает за основную логику анализа логов. Он использует потоковую обработку данных, что позволяет
обрабатывать логи как из локальных файлов, так и из URL. Этот подход предотвращает загрузку всего файла в память, что
особенно полезно для больших логов. Вместо этого, строки читаются и анализируются построчно, используя стримы Java.

### 2. Класс `LogStatistics`

Этот класс собирает статистику по логам. Он поддерживает:
- Подсчет общего числа запросов
- Определение наиболее часто запрашиваемых ресурсов
- Определение распределения по кодам ответов
- Расчет среднего и 95-процентного размера ответа
- Распределение запросов по часам и IP-адресам

### 3. Класс `LogFilter`

Содержит методы для фильтрации логов:
- **Фильтрация по времени:** Учитывает параметры `from` и `to`, чтобы анализировать логи только в указанном диапазоне.
- **Фильтрация по полям:** Возможность фильтровать логи по значениям, например, по HTTP методу (`GET`, `POST`), IP-адресу
- или User-Agent.

### 4. Класс `LogParser`

Отвечает за парсинг строк из логов и преобразование их в объекты LogEntry. Он учитывает структуру стандартных логов
NGINX и поддерживает обработку различных форматов строк.

Основные возможности:
•  Поддержка двух форматов дат: Класс LogParser может обрабатывать даты в формате ISO8601 и в старом формате
dd/MMM/yyyy:HH:mm:ss Z. Это обеспечивает гибкость и совместимость с различными форматами логов.
•  Гибкость и контроль: Написание собственного парсера позволяет полностью контролировать процесс парсинга и легко
адаптировать его под специфические требования проекта.
•  Обработка исключений: Класс LogParser корректно обрабатывает исключения, возникающие при парсинге дат, что делает
его надежным инструментом для анализа логов.

### 5. Форматирование отчетов

Программа поддерживает два формата отчетов:
- **Markdown:** Используется для простого и читабельного формата документации.
- **AsciiDoc:** Предоставляет больше возможностей форматирования и полезен для создания более сложных отчетов.

Отчеты формируются через интерфейс `ReportFormatter`, что позволяет легко добавлять новые форматы при необходимости.

## Примеры результатов

### Пример отчета в формате AsciiDoc:

```== General Information

|===
|Metric |Value |
|File(s) |`C:\Java\IntelIDEA\backend_academy_2024_project_3-java-Exsellent\logs\nginx_logs.txt` | 
|Start Date |2015-05-17 |
|End Date |2015-06-04 |
|Total Requests |51462 |
|Average Response Size |659509,51 b| |
|95th Percentile Response Size |1768 b| |
== Requested Resources

|===
|Resource |Count |
|/downloads/product_1 |30285 |
|/downloads/product_2 |21104 |
|/downloads/product_3 |73 |
== Response Codes

|===
|Code |Name |Count |
|200 |OK |4028 |
|404 |Not Found |33876 |
|500 |Internal Server Error |0 |
|403 |Forbidden |38 |
|304 |Not Modified |13330 |
|206 |Partial Content |186 |
|416 |Range Not Satisfiable |4 |
== Top IP Addresses

|===
|IP Address |Request Count |
|216.46.173.126 |2350 |
|180.179.174.219 |1720 |
|204.77.168.241 |1439 |
|65.39.197.164 |1365 |
|80.91.33.133 |1202 |
|84.208.15.12 |1120 |
|74.125.60.158 |1084 |
|119.252.76.162 |1064 |
|79.136.114.202 |628 |
|54.207.57.55 |532 |
== Hourly Request Distribution

|===
|Hour |Request Count |
|00:00 |2168 |
|01:00 |2163 |
|02:00 |2135 |
|03:00 |2145 |
|04:00 |2157 |
|05:00 |2182 |
|06:00 |2116 |
|07:00 |2041 |
|08:00 |2092 |
|09:00 |2159 |
|10:00 |2131 |
|11:00 |2102 |
|12:00 |2174 |
|13:00 |2170 |
|14:00 |2151 |
|15:00 |2178 |
|16:00 |2119 |
|17:00 |2120 |
|18:00 |2166 |
|19:00 |2124 |
|20:00 |2209 |
|21:00 |2106 |
|22:00 |2178 |
|23:00 |2176 |
|===
```
### Запуск программы

```bash
java -jar target/log-analyzer-1.0-SNAPSHOT.jar -f ./logs/nginx_logs.txt
```

## Дополнительные параметры

- **`-f` или `--file`**: Указывает путь к лог-файлу или URL.
- **`-from` и `-to`**: Опциональные параметры для фильтрации по времени в формате ISO8601.
- **`-r` или `--report`**: Указывает формат отчета (markdown или asciidoc).
- **`-filter-field` и `-filter-value`**: Указывают поле и значение для фильтрации логов.

## Тестирование

### Основные тесты включают:

1. **Проверка чтения и анализа локальных файлов и URL.**
2. **Тестирование парсинга строк логов.**
3. **Проверка работы фильтрации по времени и значениям.**
4. **Валидация форматов отчетов Markdown и AsciiDoc.**

## Заключение

**LogAnalyzer** — мощный инструмент для анализа логов серверов. Благодаря потоковой обработке данных и поддержке гибкой фильтрации, он позволяет обрабатывать большие объемы логов, создавая структурированные отчеты в удобных форматах.

```shell
mvn clean verify
```

Альтернативно можно в терминале из корня проекта выполнить следующие команды.

Для Unix (Linux, macOS, Cygwin, WSL):

```shell
./mvnw clean verify
```

Для Windows:

```shell
mvnw.cmd clean verify
```

Для окончания сборки потребуется подождать какое-то время, пока maven скачает
все необходимые зависимости, скомпилирует проект и прогонит базовый набор
тестов.

Если вы в процессе сборки получили ошибку:

```shell
Rule 0: org.apache.maven.enforcer.rules.version.RequireJavaVersion failed with message:
JDK version must be at least 22
```

Значит, версия вашего JDK ниже 22.

Если же получили ошибку:

```shell
Rule 1: org.apache.maven.enforcer.rules.version.RequireMavenVersion failed with message:
Maven version should, at least, be 3.8.8
```

Значит, у вас используется версия maven ниже 3.8.8. Такого не должно произойти,
если вы запускаете сборку из IDEA или через `mvnw`-скрипты.

Далее будут перечислены другие полезные команды maven.

Запуск только компиляции основных классов:

```shell
mvn compile
```

Запуск тестов:

```shell
mvn test
```

Запуск линтеров:

```shell
mvn checkstyle:check modernizer:modernizer spotbugs:check pmd:check pmd:cpd-check
```

Вывод дерева зависимостей проекта (полезно при отладке транзитивных
зависимостей):

```shell
mvn dependency:tree
```

Вывод вспомогательной информации о любом плагине (вместо `compiler` можно
подставить интересующий вас плагин):

```shell
mvn help:describe -Dplugin=compiler
```

## Дополнительные материалы

- Документация по maven: https://maven.apache.org/guides/index.html
- Поиск зависимостей и их версий: https://central.sonatype.com/search
- Документация по процессу автоматизированной сборки в среде github:
  https://docs.github.com/en/actions
- Документация по git: https://git-scm.com/doc
- Javadoc для Java 22:
  https://docs.oracle.com/en/java/javase/22/docs/api/index.html

[course-url]: https://edu.tinkoff.ru/all-activities/courses/870efa9d-7067-4713-97ae-7db256b73eab
